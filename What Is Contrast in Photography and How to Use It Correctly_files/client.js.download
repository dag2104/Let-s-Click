var Edgemesh=function(){"use strict";var t={read:function(t,e,i,r){let s,n;const o=8*r-i-1,h=(1<<o)-1,a=h>>1;let c=-7,l=r-1,u=t[e+l];for(l+=-1,s=u&(1<<-c)-1,u>>=-c,c+=o;c>0;s=256*s+t[e+l],l+=-1,c-=8);for(n=s&(1<<-c)-1,s>>=-c,c+=i;c>0;n=256*n+t[e+l],l+=-1,c-=8);if(0===s)s=1-a;else{if(s===h)return n?NaN:1/0*(u?-1:1);n+=Math.pow(2,i),s-=a}return(u?-1:1)*n*Math.pow(2,s-i)},write:function(t,e,i,r,s){let n,o,h,a=8*s-r-1;const c=(1<<a)-1,l=c>>1,u=23===r?Math.pow(2,-24)-Math.pow(2,-77):0;let d=0;const g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,n=c):(n=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-n))<1&&(n--,h*=2),(e+=n+l>=1?u/h:u*Math.pow(2,1-l))*h>=2&&(n++,h/=2),n+l>=c?(o=0,n=c):n+l>=1?(o=(e*h-1)*Math.pow(2,r),n+=l):(o=e*Math.pow(2,l-1)*Math.pow(2,r),n=0));r>=8;t[i+d]=255&o,d+=1,o/=256,r-=8);for(n=n<<r|o,a+=r;a>0;t[i+d]=255&n,d+=1,n/=256,a-=8);t[i+d-1]|=128*g}};function e(t){if("string"!=typeof t)throw new Error(`expected "${t}" to be a string`);if(""===t)throw new Error("string must not be empty")}function i(t){if("boolean"!=typeof t)throw new Error(`expected "${t}" to be a boolean`)}function r(t){if("number"!=typeof t)throw new Error(`expected "${t}" to be a number`)}function s(t){if(!(t instanceof Date))throw new Error(`expected "${t}" to be a date`)}function n(t){if(!Array.isArray(t))throw new Error(`expected "${t}" to be an array`);if(0===t.length)throw new Error("array must not be empty")}function o(t,e,i,r,s,n){if(e>s||e<n)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function h(t,e,i,r,s,n){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function a(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function c(t,e){var i;e=e||1/0;for(var r=t.length,s=null,n=[],o=0;o<r;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!s){if(i>56319){(e-=3)>-1&&n.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&n.push(239,191,189);continue}s=i;continue}if(i<56320){(e-=3)>-1&&n.push(239,191,189),s=i;continue}i=65536+(s-55296<<10|i-56320)}else s&&(e-=3)>-1&&n.push(239,191,189);if(s=null,i<128){if((e-=1)<0)break;n.push(i)}else if(i<2048){if((e-=2)<0)break;n.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;n.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return n}function l(t,e,i){i=Math.min(t.length,i);for(var r=[],s=e;s<i;){var n,o,h,a,c=t[s],l=null,d=c>239?4:c>223?3:c>191?2:1;if(s+d<=i)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(n=t[s+1]))&&(a=(31&c)<<6|63&n)>127&&(l=a);break;case 3:n=t[s+1],o=t[s+2],128==(192&n)&&128==(192&o)&&(a=(15&c)<<12|(63&n)<<6|63&o)>2047&&(a<55296||a>57343)&&(l=a);break;case 4:n=t[s+1],o=t[s+2],h=t[s+3],128==(192&n)&&128==(192&o)&&128==(192&h)&&(a=(15&c)<<18|(63&n)<<12|(63&o)<<6|63&h)>65535&&a<1114112&&(l=a)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=d}return function(t){var e=t.length;if(e<=u)return String.fromCharCode.apply(String,t);var i="",r=0;for(;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=u));return i}(r)}const u=4096;function d(){}d.from=function(t){if(t instanceof Uint8Array==!1)throw new Error("Buffer.from() requires a Uint8Array");const e=t;return e.__proto__=d.prototype,e},d.alloc=function(t=0){!function(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative');if(t>2147483647)throw new RangeError("Invalid typed array length")}(t);const e=new Uint8Array(t);return e.__proto__=d.prototype,e},d.byteLength=function(t){return"string"!=typeof t&&(t=""+t),0===t.length?0:c(t).length},d.prototype.__proto__=Uint8Array.prototype,d.prototype.toString=function(){const t=this.length||0;return 0===t?"":l(this,0,t)},d.prototype.indexOf=function(t,e=0){if(0===this.length)return-1;if(e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=this.length-1),e<0&&(e=this.length+e),e>=this.length)e=this.length-1;else if(e<0)return-1;return 0===t.length?-1:(t&=255,Uint8Array.prototype.indexOf.call(this,t,e))},d.prototype.slice=function(t,e){var i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);const r=this.subarray(t,e);return r.__proto__=d.prototype,r},d.prototype.write=function(t,e){var i=this.length-e;if(t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");return function(t,e,i,r){for(var s=0;s<r&&!(s+i>=e.length||s>=t.length);++s)e[s+i]=t[s];return s}(c(t,this.length-e),this,e,i)},d.prototype.writeInt8=function(t,e){return o(this,t=+t,e|=0,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},d.prototype.writeUInt8=function(t,e){return o(this,t=+t,e|=0,1,255,0),this[e]=255&t,e+1},d.prototype.writeFloatLE=function(e,i){return h(this,0,i,4),t.write(this,e,i,23,4),i+4},d.prototype.writeDoubleLE=function(e,i){return h(this,0,i,8),t.write(this,e,i,52,8),i+8},d.prototype.writeInt16LE=function(t,e){return o(this,t=+t,e|=0,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},d.prototype.writeInt32LE=function(t,e){return o(this,t=+t,e|=0,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},d.prototype.readInt8=function(t){return a(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},d.prototype.readUInt8=function(t){return a(t,1,this.length),this[t]},d.prototype.readFloatLE=function(e){return a(e,4,this.length),t.read(this,e,23,4)},d.prototype.readDoubleLE=function(e){return a(e,8,this.length),t.read(this,e,52,8)},d.prototype.readInt16LE=function(t){a(t>>>=0,2,this.length);const e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},d.prototype.readInt32LE=function(t){return a(t>>>=0,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},"undefined"==typeof window||window.Buffer?"function"!=typeof importScripts||self.Buffer||(self.Buffer=d):window.Buffer=d;var g=f,m=null;try{m=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(We){}function f(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function p(t){return!0===(t&&t.__isLong__)}Object.defineProperty(f.prototype,"__isLong__",{value:!0}),f.isLong=p;var _={},y={};function w(t,e){var i,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=y[t])?r:(i=E(t,(0|t)<0?-1:0,!0),s&&(y[t]=i),i):(s=-128<=(t|=0)&&t<128)&&(r=_[t])?r:(i=E(t,t<0?-1:0,!1),s&&(_[t]=i),i)}function v(t,e){if(isNaN(t))return e?N:x;if(e){if(t<0)return N;if(t>=S)return D}else{if(t<=-L)return M;if(t+1>=L)return B}return t<0?v(-t,e).neg():E(t%T|0,t/T|0,e)}function E(t,e,i){return new f(t,e,i)}f.fromInt=w,f.fromNumber=v,f.fromBits=E;var b=Math.pow;function C(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return x;if("number"==typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return C(t.substring(1),e,i).neg();for(var s=v(b(i,8)),n=x,o=0;o<t.length;o+=8){var h=Math.min(8,t.length-o),a=parseInt(t.substring(o,o+h),i);if(h<8){var c=v(b(i,h));n=n.mul(c).add(v(a))}else n=(n=n.mul(s)).add(v(a))}return n.unsigned=e,n}function A(t,e){return"number"==typeof t?v(t,e):"string"==typeof t?C(t,e):E(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}f.fromString=C,f.fromValue=A;var T=4294967296,S=T*T,L=S/2,I=w(1<<24),x=w(0);f.ZERO=x;var N=w(0,!0);f.UZERO=N;var U=w(1);f.ONE=U;var k=w(1,!0);f.UONE=k;var O=w(-1);f.NEG_ONE=O;var B=E(-1,2147483647,!1);f.MAX_VALUE=B;var D=E(-1,-1,!0);f.MAX_UNSIGNED_VALUE=D;var M=E(0,-2147483648,!1);f.MIN_VALUE=M;var R=f.prototype;R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},R.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(M)){var e=v(t),i=this.div(e),r=i.mul(e).sub(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=v(b(t,6),this.unsigned),n=this,o="";;){var h=n.div(s),a=(n.sub(h.mul(s)).toInt()>>>0).toString(t);if((n=h).isZero())return a+o;for(;a.length<6;)a="0"+a;o=""+a+o}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(M)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},R.isZero=function(){return 0===this.high&&0===this.low},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return 1==(1&this.low)},R.isEven=function(){return 0==(1&this.low)},R.equals=function(t){return p(t)||(t=A(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},R.eq=R.equals,R.notEquals=function(t){return!this.eq(t)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(t){return this.comp(t)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(t){return this.comp(t)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(t){return this.comp(t)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(t){return this.comp(t)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(t){if(p(t)||(t=A(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(M)?M:this.not().add(U)},R.neg=R.negate,R.add=function(t){p(t)||(t=A(t));var e=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,n=t.high>>>16,o=65535&t.high,h=t.low>>>16,a=0,c=0,l=0,u=0;return l+=(u+=s+(65535&t.low))>>>16,c+=(l+=r+h)>>>16,a+=(c+=i+o)>>>16,a+=e+n,E((l&=65535)<<16|(u&=65535),(a&=65535)<<16|(c&=65535),this.unsigned)},R.subtract=function(t){return p(t)||(t=A(t)),this.add(t.neg())},R.sub=R.subtract,R.multiply=function(t){if(this.isZero())return x;if(p(t)||(t=A(t)),m)return E(m.mul(this.low,this.high,t.low,t.high),m.get_high(),this.unsigned);if(t.isZero())return x;if(this.eq(M))return t.isOdd()?M:x;if(t.eq(M))return this.isOdd()?M:x;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(I)&&t.lt(I))return v(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,n=t.high>>>16,o=65535&t.high,h=t.low>>>16,a=65535&t.low,c=0,l=0,u=0,d=0;return u+=(d+=s*a)>>>16,l+=(u+=r*a)>>>16,u&=65535,l+=(u+=s*h)>>>16,c+=(l+=i*a)>>>16,l&=65535,c+=(l+=r*h)>>>16,l&=65535,c+=(l+=s*o)>>>16,c+=e*a+i*h+r*o+s*n,E((u&=65535)<<16|(d&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},R.mul=R.multiply,R.divide=function(t){if(p(t)||(t=A(t)),t.isZero())throw Error("division by zero");var e,i,r;if(m)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?E((this.unsigned?m.div_u:m.div_s)(this.low,this.high,t.low,t.high),m.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?N:x;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return N;if(t.gt(this.shru(1)))return k;r=N}else{if(this.eq(M))return t.eq(U)||t.eq(O)?M:t.eq(M)?U:(e=this.shr(1).div(t).shl(1)).eq(x)?t.isNegative()?U:O:(i=this.sub(t.mul(e)),r=e.add(i.div(t)));if(t.eq(M))return this.unsigned?N:x;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=x}for(i=this;i.gte(t);){e=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),n=s<=48?1:b(2,s-48),o=v(e),h=o.mul(t);h.isNegative()||h.gt(i);)h=(o=v(e-=n,this.unsigned)).mul(t);o.isZero()&&(o=U),r=r.add(o),i=i.sub(h)}return r},R.div=R.divide,R.modulo=function(t){return p(t)||(t=A(t)),m?E((this.unsigned?m.rem_u:m.rem_s)(this.low,this.high,t.low,t.high),m.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return E(~this.low,~this.high,this.unsigned)},R.and=function(t){return p(t)||(t=A(t)),E(this.low&t.low,this.high&t.high,this.unsigned)},R.or=function(t){return p(t)||(t=A(t)),E(this.low|t.low,this.high|t.high,this.unsigned)},R.xor=function(t){return p(t)||(t=A(t)),E(this.low^t.low,this.high^t.high,this.unsigned)},R.shiftLeft=function(t){return p(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?E(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):E(0,this.low<<t-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(t){return p(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?E(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):E(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(t){if(p(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?E(this.low>>>t|e<<32-t,e>>>t,this.unsigned):E(32===t?e:e>>>t-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.toSigned=function(){return this.unsigned?E(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:E(this.low,this.high,!0)},R.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},R.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},f.fromBytes=function(t,e,i){return i?f.fromBytesLE(t,e):f.fromBytesBE(t,e)},f.fromBytesLE=function(t,e){return new f(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},f.fromBytesBE=function(t,e){return new f(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};for(var W=[],P={},z=0;z<256;z++)W[z]=(z+256).toString(16).substr(1),P[W[z]]=z;var $=function(t,e,i){var r=e&&i||0,s=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,(function(t){s<16&&(e[r+s++]=P[t])}));s<16;)e[r+s++]=0;return e};const j=32767,q=0-j,F=-2147483648,H=2147483647,V=0-H,G=Buffer.alloc(1);G.writeUInt8(0,0);const Z={boolean:1,guid:2,byte:4,short:5,int:6,long:7,real:8,float:9,char:10,symbol:11,timestamp:12,month:13,date:14,datetime:15,timespan:16,minute:17,second:18,time:19},Y={boolean:1,guid:16,byte:1,short:2,int:4,long:8,real:4,float:8,char:1,timestamp:8,month:4,date:4,datetime:8,timespan:8,minute:4,second:4,time:4},J=/^`\S+$/;class Q{constructor(t,e,i){this._type=t,this._value=e,this._valuetype=i}get type(){return this._type}get value(){return this._value}get valuetype(){if("typedlist"!==this._type)throw new Error("only available for type typedlist");return this._valuetype}toString(){return"typedlist"===this._type?`list[${this._valuetype}](${this._value})`:`${this._type}(${this._value})`}}function X(t,e,i){return n(e),e.forEach((function(e){t(e)})),new Q("typedlist",e,i)}const K=function(t){return t instanceof Q};var tt=Object.freeze({__proto__:null,Typed:Q,b:function(t){return i(t),new Q("boolean",t)},B:function(t){return X(i,t,"boolean")},g:function(t){return e(t),new Q("guid",t)},G:function(t){return X(e,t,"guid")},x:function(t){return r(t),new Q("byte",t)},X:function(t){return X(r,t,"byte")},h:function(t){return r(t),new Q("short",t)},H:function(t){return X(r,t,"short")},i:function(t){return r(t),new Q("int",t)},I:function(t){return X(r,t,"int")},j:function({low:t,high:e}){if(t===1/0||t===-1/0)return new Q("long",t);if(e===1/0||e===-1/0)return new Q("long",e);if(!t&&0!==t||!e&&0!==e)throw new Error("low and high required for long");const i=new g(t,e);return new Q("long",i)},J:function(t){return t=t.map(t=>{if(t.low===1/0||t.low===-1/0)return t.low;if(t.high===1/0||t.high===-1/0)return t.high;if(!t.low&&0!==t.low||!t.high&&0!==t.high)throw new Error("low and high required for long");return new g(t.low,t.high)}),new Q("typedlist",t,"long")},e:function(t){return r(t),new Q("real",t)},E:function(t){return X(r,t,"real")},f:function(t){return r(t),new Q("float",t)},F:function(t){return X(r,t,"float")},c:function(t){return e(t),new Q("char",t)},C:function(t){return X(e,t,"char")},s:function(t){return e(t),new Q("symbol",t)},S:function(t){return X(e,t,"symbol")},p:function(t){return s(t),new Q("timestamp",t)},P:function(t){return X(s,t,"timestamp")},m:function(t){return s(t),new Q("month",t)},M:function(t){return X(s,t,"month")},d:function(t){return s(t),new Q("date",t)},D:function(t){return X(s,t,"date")},z:function(t){return s(t),new Q("datetime",t)},Z:function(t){return X(s,t,"datetime")},n:function(t){return s(t),new Q("timespan",t)},N:function(t){return X(s,t,"timespan")},u:function(t){return s(t),new Q("minute",t)},U:function(t){return X(s,t,"minute")},v:function(t){return s(t),new Q("second",t)},V:function(t){return X(s,t,"second")},t:function(t){return s(t),new Q("time",t)},T:function(t){return X(s,t,"time")},dict:function(t){return function(t){if("object"!=typeof t||null===t)throw new Error(`expected "${t}" to be an object`);if(0===Object.keys(t).length)throw new Error("object must not be empty")}(t),new Q("dict",t)},list:function(t){return n(t),new Q("mixedlist",t)},isTyped:K});function et(t){var e=Z[t];if(void 0===e)throw new Error("bad type "+t);return e}function it(t){var e=Y[t];if(void 0===e)throw new Error("bad type "+t);return e}function rt(t){return K(t)?t.type:null===t?"null":"number"==typeof t?"float":t instanceof Date?"datetime":"boolean"==typeof t?"boolean":Array.isArray(t)?"list":"string"==typeof t?"string":"object"==typeof t?"dict":void 0}function st(t,e){return"list"!==e&&"typedlist"!==e&&"mixedlist"!==e&&"string"!==e&&"dict"!==e&&"null"!==e&&t.every((function(t){return rt(t)===e}))}function nt(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(t[e]);return i}const ot={enc:function(t){var e,i=0;function r(t){e.writeInt8(t,i),i+=1}function s(t){e.writeUInt8(t,i),i+=1}function n(t){e.writeDoubleLE(t,i),i+=8}function o(t,r){if(1===t)e.writeInt8(r,i);else if(2===t)e.writeInt16LE(r,i);else{if(4!==t)throw new Error("only n = 1, 2 or 4 is supported");e.writeInt32LE(r,i)}i+=t}function h(t){t===1/0?(s(255),s(255),s(255),s(255),s(255),s(255),s(255),s(127)):t===-1/0?(s(1),s(0),s(0),s(0),s(0),s(0),s(0),s(128)):function(t){o(4,t.low),o(4,t.high)}(t)}function a(t){i+=e.write(t,i)}function c(t){null!==t&&a(t),r(0)}var l={boolean:function(t){r(t?1:0)},guid:function(t){$(t,e,i),i+=16},byte:function(t){r(t)},short:function(t){o(2,t===1/0?j:t===-1/0?q:t)},int:function(t){o(4,t===1/0?H:t===-1/0?V:t)},long:h,real:function(t){t===1/0?(s(0),s(0),s(128),s(127)):t===-1/0?(s(0),s(0),s(128),s(255)):function(t){e.writeFloatLE(t,i),i+=4}(t)},float:function(t){t===1/0?(s(0),s(0),s(0),s(0),s(0),s(0),s(240),s(127)):t===-1/0?(s(0),s(0),s(0),s(0),s(0),s(0),s(240),s(255)):n(t)},char:function(t){s(t.charCodeAt())},symbol:c,timestamp:function(t){h(g.fromNumber(864e11*(t.getTime()/864e5-10957)))},month:function(t){o(4,12*(t.getUTCFullYear()-2e3)+t.getUTCMonth())},date:function(t){o(4,t.getTime()/864e5-10957)},datetime:function(t){n(t.getTime()/864e5-10957)},timespan:function(t){var e=1e3*(1e3*(60*(60*t.getUTCHours()+t.getUTCMinutes())+t.getUTCSeconds())+t.getUTCMilliseconds())*1e3;h(g.fromNumber(e))},minute:function(t){o(4,60*t.getUTCHours()+t.getUTCMinutes())},second:function(t){o(4,60*(60*t.getUTCHours()+t.getUTCMinutes())+t.getUTCSeconds())},time:function(t){o(4,1e3*(60*(60*t.getUTCHours()+t.getUTCMinutes())+t.getUTCSeconds())+t.getUTCMilliseconds())}};function u(t){var e=l[t];if(void 0===e)throw new Error("bad type "+t);return e}var d=function t(e,i){var r,s;switch(i?r=i:K(e)?("typedlist"===(r=e.type)&&(s=e.valuetype),e=e.value):r=rt(e),r){case"null":return 2;case"symbol":return null===e?2:2+Buffer.byteLength(e,"utf8");case"dict":for(var n=7,o=Object.keys(e),h=0;h<o.length;h++)n+=1+o[h].length;return n+t(nt(e));case"list":if(e.length>0&&null==i){var a=rt(e[0]);if(st(e,a))return t(new Q("typedlist",e.map((function(t){return K(t)?t.value:t})),a))}return t(e,"mixedlist");case"mixedlist":for(n=6,h=0;h<e.length;h++)n+=t(e[h],null);return n;case"typedlist":n=6;if("symbol"===s)for(h=0;h<e.length;h++)n+=1+Buffer.byteLength(e[h],"utf8");else n+=it(s)*e.length;return n;case"string":return n=Buffer.byteLength(e,"utf8")+(J.test(e)?1:6)}return 1+it(r)}(t,null);return e=Buffer.alloc(8+d),r(1),r(0),r(0),r(0),o(4,e.length),function t(e,i){var s,n;switch(i?s=i:K(e)?("typedlist"===(s=e.type)&&(n=e.valuetype),e=e.value):s=rt(e),s){case"null":return r(101),void r(0);case"dict":var h=Object.keys(e);r(99),r(11),r(0),o(4,h.length);for(var l=0;l<h.length;l++)c(h[l]);return void t(nt(e));case"list":if(e.length>0&&null==i){var d=rt(e[0]);if(st(e,d))return t(new Q("typedlist",e.map((function(t){return K(t)?t.value:t})),d))}return t(e,"mixedlist");case"mixedlist":r(0),r(0),o(4,e.length);for(l=0;l<e.length;l++)t(e[l],null);return;case"typedlist":r(et(n)),r(0),o(4,e.length);var g=u(n);return void e.forEach(g);case"string":return void(J.test(e)?t(e.substr(1),"symbol"):(r(10),r(0),o(4,Buffer.byteLength(e,"utf8")),a(e)))}var m=et(s);g=u(s);r(0-m),g(e)}(t,null),e},dec:function(t,e=!0){let i=8;function r(){return 1===o()}function s(){const t=a();return 32===t?null:String.fromCharCode(t)}function n(e){const r=t.slice(i,i+e).toString("utf8");return i+=e,r}function o(){const e=t.readInt8(i);return i+=1,e}function h(e){let r;if(1===e)r=t.readInt8(i);else if(2===e)r=t.readInt16LE(i);else{if(4!==e)throw new Error("only n = 1, 2 or 4 is supported");r=t.readInt32LE(i)}return i+=e,r}function a(){const e=t.readUInt8(i);return i+=1,e}function c(){const t="0123456789abcdef";let e="";for(let i=0;i<16;i++){const r=a();e+=4===i||6===i||8===i||10===i?"-":"",e+=t[r>>4],e+=t[15&r]}return e}function l(){const t=h(2);return t===j?1/0:t===q?-1/0:t}function u(){const t=h(4);return t===H?1/0:t===V?-1/0:t}function d(){const t=h(4),e=h(4),i=new g(t,e,!1);return-1===t&&e===H?1/0:1===t&&e===F?-1/0:i}function m(){const e=t.readFloatLE(i);return i+=4,e}function f(){const e=t.readDoubleLE(i);return i+=8,e}function p(){const e=n(t.indexOf(G,i)-i);return i+=1,e}function _(){const t=d();return!1===e?864e11*(10957+t/864e11):w(t/864e11)}function y(){let t=u();const e=t%12;return t=2e3+t/12,new Date(Date.UTC(t,e,1))}function w(t){return new Date(864e5*(10957+t))}function v(){const t=u();return null===t?null:w(t)}function E(){const t=f();return null===t?null:w(t)}function b(){const t=d();return!1===e?t:w(t/864e11)}function C(){return w(u()/86400)}function A(){return w(u()/1440)}function T(){return w(u()/864e5)}return function t(){const e=[t,r,c,null,a,l,u,d,m,f,s,p,_,y,v,E,b,A,C,T];let h,g=0;const w=o();if(-128===w)throw new Error(p());if(w<0&&w>-20)return e[-w]();if(w>99&&w<104)return 0===o()&&101===w?null:"func";if(99===w){const e=t(),i=t(),r={};for(g=0;g<e.length;g++)r[e[g]]=i[g];return r}if(i++,h=u(),10===w)return n(h);const S=new Array(h),L=e[w];for(g=0;g<h;g++)S[g]=L();return S}()}};Object.keys({b:"boolean",g:"guid",x:"byte",h:"short",i:"int",j:"long",e:"real",f:"float",c:"char",s:"symbol",p:"timestamp",m:"month",d:"date",z:"datetime",n:"timespan",u:"minute",v:"second",t:"time"}).forEach(t=>{ot[t]=tt[t],ot[t.toUpperCase()]=tt[t.toUpperCase()]}),["dict","list"].forEach(t=>{ot[t]=tt[t]});try{self.edgemesh.v["edgemesh:protocol:3.1.3"]=1}catch(We){}ot.UNDEFINED="xxx",ot.hexToLowHigh=t=>{if(18===t.length&&"0"===t[0]&&"x"===t[1]&&(t=t.substr(2,16)),16!==t.length)throw new Error(`Expected hex to be length 16, got ${t.length}.`);return{high:`0x${t.slice(0,8)}`,low:`0x${t.slice(8,16)}`}},ot.lowHighToHex=(t,e=!0)=>{let i="";return e&&(i+="0x"),i+=t.toUnsigned().toString(16).padStart(16,"0")},ot.posToLowHigh=(t,e)=>{const i=t.length-2;if(i&&0==(i&i-1)&&"0"===t[0]&&"x"===t[1]&&(t=t.substr(2,t.length)),t.length<=16)throw new Error(`Expected n to be at least length 16, got ${t.length}.`);const r=8*(e*=2),s=r+8;return{high:`0x${t.slice(r,s)}`,low:`0x${t.slice(s,s+8)}`}};const ht=ot.enc,at=ot.dec,ct=ot.hexToLowHigh,lt=ot.lowHighToHex,ut=ot.j,dt=ot.s;try{self.edgemesh.v["edgemesh:core:3.1.3"]=1}catch(We){}const gt=(t,...e)=>{let i=t;return e.length>0&&(i+=` :: ${JSON.stringify(e)}`),i};class mt extends Error{constructor(t,e){super(gt(t,e)),this.name=t,this.details=e}}const ft=["__RESERVED","NODE_ID","TOPIC","SET_DEBUG","SET_CONFIG","ADD_PULSE","SEND_PULSE","NAVIGATE","SOFT_DISABLE","RESOURCE_EVENT","NAVIGATION_EVENT","CACHE_EVENT","FIREWALL_EVENT","BALANCE_EVENT","ERROR_EVENT"],pt=t=>{if("string"==typeof t){const e=ft.indexOf(t);if(-1===e)throw new mt("code-does-not-exist",{code:t});return e}{const e=ft[t];if(!e)throw new mt("code-does-not-exist",{code:t});return e}};function _t(){const t=new Uint8Array(8);crypto.getRandomValues(t);const e=new ArrayBuffer(4);let i=new DataView(e);i.setUint32(0,Date.now(),!1),i=new Uint8Array(i.buffer);for(let r=0;r<4;r++)t[r]=i[r];return function(t){const e=[],i=new DataView(t);for(let r=0;r<i.byteLength;r+=4){const t=i.getUint32(r).toString(16),s="00000000",n=(s+t).slice(-s.length);e.push(n)}return`0x${e.join("")}`}(t.buffer)}var yt={debug:0,log:1,warn:2,error:3,silent:4},wt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function vt(t,e){return t(e={exports:{}},e.exports),e.exports}var Et={UINT32:vt((function(t){!function(e){i(Math.pow(36,5)),i(Math.pow(16,7)),i(Math.pow(10,9)),i(Math.pow(2,30)),i(36),i(16),i(10),i(2);function i(t,e){return this instanceof i?(this._low=0,this._high=0,this.remainder=null,void 0===e?s.call(this,t):"string"==typeof t?n.call(this,t,e):void r.call(this,t,e)):new i(t,e)}function r(t,e){return this._low=0|t,this._high=0|e,this}function s(t){return this._low=65535&t,this._high=t>>>16,this}function n(t,e){var i=parseInt(t,e||10);return this._low=65535&i,this._high=i>>>16,this}i.prototype.fromBits=r,i.prototype.fromNumber=s,i.prototype.fromString=n,i.prototype.toNumber=function(){return 65536*this._high+this._low},i.prototype.toString=function(t){return this.toNumber().toString(t||10)},i.prototype.add=function(t){var e=this._low+t._low,i=e>>>16;return i+=this._high+t._high,this._low=65535&e,this._high=65535&i,this},i.prototype.subtract=function(t){return this.add(t.clone().negate())},i.prototype.multiply=function(t){var e,i,r=this._high,s=this._low,n=t._high,o=t._low;return e=(i=s*o)>>>16,e+=r*o,e&=65535,e+=s*n,this._low=65535&i,this._high=65535&e,this},i.prototype.div=function(t){if(0==t._low&&0==t._high)throw Error("division by zero");if(0==t._high&&1==t._low)return this.remainder=new i(0),this;if(t.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(t))return this.remainder=new i(0),this._low=1,this._high=0,this;for(var e=t.clone(),r=-1;!this.lt(e);)e.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._low=0,this._high=0;r>=0;r--)e.shiftRight(1),this.remainder.lt(e)||(this.remainder.subtract(e),r>=16?this._high|=1<<r-16:this._low|=1<<r);return this},i.prototype.negate=function(){var t=1+(65535&~this._low);return this._low=65535&t,this._high=~this._high+(t>>>16)&65535,this},i.prototype.equals=i.prototype.eq=function(t){return this._low==t._low&&this._high==t._high},i.prototype.greaterThan=i.prototype.gt=function(t){return this._high>t._high||!(this._high<t._high)&&this._low>t._low},i.prototype.lessThan=i.prototype.lt=function(t){return this._high<t._high||!(this._high>t._high)&&this._low<t._low},i.prototype.or=function(t){return this._low|=t._low,this._high|=t._high,this},i.prototype.and=function(t){return this._low&=t._low,this._high&=t._high,this},i.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},i.prototype.xor=function(t){return this._low^=t._low,this._high^=t._high,this},i.prototype.shiftRight=i.prototype.shiftr=function(t){return t>16?(this._low=this._high>>t-16,this._high=0):16==t?(this._low=this._high,this._high=0):(this._low=this._low>>t|this._high<<16-t&65535,this._high>>=t),this},i.prototype.shiftLeft=i.prototype.shiftl=function(t,e){return t>16?(this._high=this._low<<t-16,this._low=0,e||(this._high&=65535)):16==t?(this._high=this._low,this._low=0):(this._high=this._high<<t|this._low>>16-t,this._low=this._low<<t&65535,e||(this._high&=65535)),this},i.prototype.rotateLeft=i.prototype.rotl=function(t){var e=this._high<<16|this._low;return e=e<<t|e>>>32-t,this._low=65535&e,this._high=e>>>16,this},i.prototype.rotateRight=i.prototype.rotr=function(t){var e=this._high<<16|this._low;return e=e>>>t|e<<32-t,this._low=65535&e,this._high=e>>>16,this},i.prototype.clone=function(){return new i(this._low,this._high)},t.exports?t.exports=i:e.UINT32=i}(wt)})),UINT64:vt((function(t){!function(e){var i={16:s(Math.pow(16,5)),10:s(Math.pow(10,5)),2:s(Math.pow(2,5))},r={16:s(16),10:s(10),2:s(2)};function s(t,e,i,r){return this instanceof s?(this.remainder=null,"string"==typeof t?h.call(this,t,e):void 0===e?o.call(this,t):void n.apply(this,arguments)):new s(t,e,i,r)}function n(t,e,i,r){return void 0===i?(this._a00=65535&t,this._a16=t>>>16,this._a32=65535&e,this._a48=e>>>16,this):(this._a00=0|t,this._a16=0|e,this._a32=0|i,this._a48=0|r,this)}function o(t){return this._a00=65535&t,this._a16=t>>>16,this._a32=0,this._a48=0,this}function h(t,e){e=e||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var r=i[e]||new s(Math.pow(e,5)),n=0,o=t.length;n<o;n+=5){var h=Math.min(5,o-n),a=parseInt(t.slice(n,n+h),e);this.multiply(h<5?new s(Math.pow(e,h)):r).add(new s(a))}return this}s.prototype.fromBits=n,s.prototype.fromNumber=o,s.prototype.fromString=h,s.prototype.toNumber=function(){return 65536*this._a16+this._a00},s.prototype.toString=function(t){var e=r[t=t||10]||new s(t);if(!this.gt(e))return this.toNumber().toString(t);for(var i=this.clone(),n=new Array(64),o=63;o>=0&&(i.div(e),n[o]=i.remainder.toNumber().toString(t),i.gt(e));o--);return n[o-1]=i.toNumber().toString(t),n.join("")},s.prototype.add=function(t){var e=this._a00+t._a00,i=e>>>16,r=(i+=this._a16+t._a16)>>>16,s=(r+=this._a32+t._a32)>>>16;return s+=this._a48+t._a48,this._a00=65535&e,this._a16=65535&i,this._a32=65535&r,this._a48=65535&s,this},s.prototype.subtract=function(t){return this.add(t.clone().negate())},s.prototype.multiply=function(t){var e=this._a00,i=this._a16,r=this._a32,s=this._a48,n=t._a00,o=t._a16,h=t._a32,a=e*n,c=a>>>16,l=(c+=e*o)>>>16;c&=65535,l+=(c+=i*n)>>>16;var u=(l+=e*h)>>>16;return l&=65535,u+=(l+=i*o)>>>16,l&=65535,u+=(l+=r*n)>>>16,u+=e*t._a48,u&=65535,u+=i*h,u&=65535,u+=r*o,u&=65535,u+=s*n,this._a00=65535&a,this._a16=65535&c,this._a32=65535&l,this._a48=65535&u,this},s.prototype.div=function(t){if(0==t._a16&&0==t._a32&&0==t._a48){if(0==t._a00)throw Error("division by zero");if(1==t._a00)return this.remainder=new s(0),this}if(t.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(t))return this.remainder=new s(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var e=t.clone(),i=-1;!this.lt(e);)e.shiftLeft(1,!0),i++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;i>=0;i--)e.shiftRight(1),this.remainder.lt(e)||(this.remainder.subtract(e),i>=48?this._a48|=1<<i-48:i>=32?this._a32|=1<<i-32:i>=16?this._a16|=1<<i-16:this._a00|=1<<i);return this},s.prototype.negate=function(){var t=1+(65535&~this._a00);return this._a00=65535&t,t=(65535&~this._a16)+(t>>>16),this._a16=65535&t,t=(65535&~this._a32)+(t>>>16),this._a32=65535&t,this._a48=~this._a48+(t>>>16)&65535,this},s.prototype.equals=s.prototype.eq=function(t){return this._a48==t._a48&&this._a00==t._a00&&this._a32==t._a32&&this._a16==t._a16},s.prototype.greaterThan=s.prototype.gt=function(t){return this._a48>t._a48||!(this._a48<t._a48)&&(this._a32>t._a32||!(this._a32<t._a32)&&(this._a16>t._a16||!(this._a16<t._a16)&&this._a00>t._a00))},s.prototype.lessThan=s.prototype.lt=function(t){return this._a48<t._a48||!(this._a48>t._a48)&&(this._a32<t._a32||!(this._a32>t._a32)&&(this._a16<t._a16||!(this._a16>t._a16)&&this._a00<t._a00))},s.prototype.or=function(t){return this._a00|=t._a00,this._a16|=t._a16,this._a32|=t._a32,this._a48|=t._a48,this},s.prototype.and=function(t){return this._a00&=t._a00,this._a16&=t._a16,this._a32&=t._a32,this._a48&=t._a48,this},s.prototype.xor=function(t){return this._a00^=t._a00,this._a16^=t._a16,this._a32^=t._a32,this._a48^=t._a48,this},s.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},s.prototype.shiftRight=s.prototype.shiftr=function(t){return(t%=64)>=48?(this._a00=this._a48>>t-48,this._a16=0,this._a32=0,this._a48=0):t>=32?(t-=32,this._a00=65535&(this._a32>>t|this._a48<<16-t),this._a16=this._a48>>t&65535,this._a32=0,this._a48=0):t>=16?(t-=16,this._a00=65535&(this._a16>>t|this._a32<<16-t),this._a16=65535&(this._a32>>t|this._a48<<16-t),this._a32=this._a48>>t&65535,this._a48=0):(this._a00=65535&(this._a00>>t|this._a16<<16-t),this._a16=65535&(this._a16>>t|this._a32<<16-t),this._a32=65535&(this._a32>>t|this._a48<<16-t),this._a48=this._a48>>t&65535),this},s.prototype.shiftLeft=s.prototype.shiftl=function(t,e){return(t%=64)>=48?(this._a48=this._a00<<t-48,this._a32=0,this._a16=0,this._a00=0):t>=32?(t-=32,this._a48=this._a16<<t|this._a00>>16-t,this._a32=this._a00<<t&65535,this._a16=0,this._a00=0):t>=16?(t-=16,this._a48=this._a32<<t|this._a16>>16-t,this._a32=65535&(this._a16<<t|this._a00>>16-t),this._a16=this._a00<<t&65535,this._a00=0):(this._a48=this._a48<<t|this._a32>>16-t,this._a32=65535&(this._a32<<t|this._a16>>16-t),this._a16=65535&(this._a16<<t|this._a00>>16-t),this._a00=this._a00<<t&65535),e||(this._a48&=65535),this},s.prototype.rotateLeft=s.prototype.rotl=function(t){if(0==(t%=64))return this;if(t>=32){var e=this._a00;if(this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}var i=this._a48<<16|this._a32,r=this._a16<<16|this._a00,s=i<<t|r>>>32-t,n=r<<t|i>>>32-t;return this._a00=65535&n,this._a16=n>>>16,this._a32=65535&s,this._a48=s>>>16,this},s.prototype.rotateRight=s.prototype.rotr=function(t){if(0==(t%=64))return this;if(t>=32){var e=this._a00;if(this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}var i=this._a48<<16|this._a32,r=this._a16<<16|this._a00,s=i>>>t|r<<32-t,n=r>>>t|i<<32-t;return this._a00=65535&n,this._a16=n>>>16,this._a32=65535&s,this._a48=s>>>16,this},s.prototype.clone=function(){return new s(this._a00,this._a16,this._a32,this._a48)},t.exports?t.exports=s:e.UINT64=s}(wt)}))},bt=Et.UINT32;bt.prototype.xxh_update=function(t,e){var i,r,s=At._low,n=At._high;i=(r=t*s)>>>16,i+=e*s,i&=65535,i+=t*n;var o=this._low+(65535&r),h=o>>>16,a=(h+=this._high+(65535&i))<<16|65535&o;h=(a=a<<13|a>>>19)>>>16,i=(r=(o=65535&a)*(s=Ct._low))>>>16,i+=h*s,i&=65535,i+=o*(n=Ct._high),this._low=65535&r,this._high=65535&i};var Ct=bt("2654435761"),At=bt("2246822519"),Tt=bt("3266489917"),St=bt("668265263"),Lt=bt("374761393");function It(){return 2==arguments.length?new It(arguments[1]).update(arguments[0]).digest():this instanceof It?void xt.call(this,arguments[0]):new It(arguments[0])}function xt(t){return this.seed=t instanceof bt?t.clone():bt(t),this.v1=this.seed.clone().add(Ct).add(At),this.v2=this.seed.clone().add(At),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(Ct),this.total_len=0,this.memsize=0,this.memory=null,this}It.prototype.init=xt,It.prototype.update=function(t){var e,i="string"==typeof t;i&&(t=function(t){for(var e=[],i=0,r=t.length;i<r;i++){var s=t.charCodeAt(i);s<128?e.push(s):s<2048?e.push(192|s>>6,128|63&s):s<55296||s>=57344?e.push(224|s>>12,128|s>>6&63,128|63&s):(i++,s=65536+((1023&s)<<10|1023&t.charCodeAt(i)),e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return new Uint8Array(e)}(t),i=!1,e=!0),"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&(e=!0,t=new Uint8Array(t));var r=0,s=t.length,n=r+s;if(0==s)return this;if(this.total_len+=s,0==this.memsize&&(this.memory=i?"":e?new Uint8Array(16):new Buffer(16)),this.memsize+s<16)return i?this.memory+=t:e?this.memory.set(t.subarray(0,s),this.memsize):t.copy(this.memory,this.memsize,0,s),this.memsize+=s,this;if(this.memsize>0){i?this.memory+=t.slice(0,16-this.memsize):e?this.memory.set(t.subarray(0,16-this.memsize),this.memsize):t.copy(this.memory,this.memsize,0,16-this.memsize);var o=0;i?(this.v1.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2)),o+=4,this.v2.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2)),o+=4,this.v3.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2)),o+=4,this.v4.xxh_update(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2))):(this.v1.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2]),o+=4,this.v2.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2]),o+=4,this.v3.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2]),o+=4,this.v4.xxh_update(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2])),r+=16-this.memsize,this.memsize=0,i&&(this.memory="")}if(r<=n-16){var h=n-16;do{i?(this.v1.xxh_update(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2)),r+=4,this.v2.xxh_update(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2)),r+=4,this.v3.xxh_update(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2)),r+=4,this.v4.xxh_update(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2))):(this.v1.xxh_update(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4,this.v2.xxh_update(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4,this.v3.xxh_update(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4,this.v4.xxh_update(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2])),r+=4}while(r<=h)}return r<n&&(i?this.memory+=t.slice(r):e?this.memory.set(t.subarray(r,n),this.memsize):t.copy(this.memory,this.memsize,r,n),this.memsize=n-r),this},It.prototype.digest=function(){var t,e,i=this.memory,r="string"==typeof i,s=0,n=this.memsize,o=new bt;for((t=this.total_len>=16?this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):this.seed.clone().add(Lt)).add(o.fromNumber(this.total_len));s<=n-4;)r?o.fromBits(i.charCodeAt(s+1)<<8|i.charCodeAt(s),i.charCodeAt(s+3)<<8|i.charCodeAt(s+2)):o.fromBits(i[s+1]<<8|i[s],i[s+3]<<8|i[s+2]),t.add(o.multiply(Tt)).rotl(17).multiply(St),s+=4;for(;s<n;)o.fromBits(r?i.charCodeAt(s++):i[s++],0),t.add(o.multiply(Lt)).rotl(11).multiply(Ct);return e=t.clone().shiftRight(15),t.xor(e).multiply(At),e=t.clone().shiftRight(13),t.xor(e).multiply(Tt),e=t.clone().shiftRight(16),t.xor(e),this.init(this.seed),t};var Nt=It,Ut=Et.UINT64,kt=Ut("11400714785074694791"),Ot=Ut("14029467366897019727"),Bt=Ut("1609587929392839161"),Dt=Ut("9650029242287828579"),Mt=Ut("2870177450012600261");function Rt(){return 2==arguments.length?new Rt(arguments[1]).update(arguments[0]).digest():this instanceof Rt?void Wt.call(this,arguments[0]):new Rt(arguments[0])}function Wt(t){return this.seed=t instanceof Ut?t.clone():Ut(t),this.v1=this.seed.clone().add(kt).add(Ot),this.v2=this.seed.clone().add(Ot),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(kt),this.total_len=0,this.memsize=0,this.memory=null,this}Rt.prototype.init=Wt,Rt.prototype.update=function(t){var e,i="string"==typeof t;i&&(t=function(t){for(var e=[],i=0,r=t.length;i<r;i++){var s=t.charCodeAt(i);s<128?e.push(s):s<2048?e.push(192|s>>6,128|63&s):s<55296||s>=57344?e.push(224|s>>12,128|s>>6&63,128|63&s):(i++,s=65536+((1023&s)<<10|1023&t.charCodeAt(i)),e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return new Uint8Array(e)}(t),i=!1,e=!0),"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&(e=!0,t=new Uint8Array(t));var r=0,s=t.length,n=r+s;if(0==s)return this;if(this.total_len+=s,0==this.memsize&&(this.memory=i?"":e?new Uint8Array(32):new Buffer(32)),this.memsize+s<32)return i?this.memory+=t:e?this.memory.set(t.subarray(0,s),this.memsize):t.copy(this.memory,this.memsize,0,s),this.memsize+=s,this;if(this.memsize>0){i?this.memory+=t.slice(0,32-this.memsize):e?this.memory.set(t.subarray(0,32-this.memsize),this.memsize):t.copy(this.memory,this.memsize,0,32-this.memsize);var o=0;if(i)a=Ut(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v1.add(a.multiply(Ot)).rotl(31).multiply(kt),o+=8,a=Ut(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v2.add(a.multiply(Ot)).rotl(31).multiply(kt),o+=8,a=Ut(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v3.add(a.multiply(Ot)).rotl(31).multiply(kt),o+=8,a=Ut(this.memory.charCodeAt(o+1)<<8|this.memory.charCodeAt(o),this.memory.charCodeAt(o+3)<<8|this.memory.charCodeAt(o+2),this.memory.charCodeAt(o+5)<<8|this.memory.charCodeAt(o+4),this.memory.charCodeAt(o+7)<<8|this.memory.charCodeAt(o+6)),this.v4.add(a.multiply(Ot)).rotl(31).multiply(kt);else a=Ut(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v1.add(a.multiply(Ot)).rotl(31).multiply(kt),o+=8,a=Ut(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v2.add(a.multiply(Ot)).rotl(31).multiply(kt),o+=8,a=Ut(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v3.add(a.multiply(Ot)).rotl(31).multiply(kt),o+=8,a=Ut(this.memory[o+1]<<8|this.memory[o],this.memory[o+3]<<8|this.memory[o+2],this.memory[o+5]<<8|this.memory[o+4],this.memory[o+7]<<8|this.memory[o+6]),this.v4.add(a.multiply(Ot)).rotl(31).multiply(kt);r+=32-this.memsize,this.memsize=0,i&&(this.memory="")}if(r<=n-32){var h=n-32;do{var a;if(i)a=Ut(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2),t.charCodeAt(r+5)<<8|t.charCodeAt(r+4),t.charCodeAt(r+7)<<8|t.charCodeAt(r+6)),this.v1.add(a.multiply(Ot)).rotl(31).multiply(kt),r+=8,a=Ut(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2),t.charCodeAt(r+5)<<8|t.charCodeAt(r+4),t.charCodeAt(r+7)<<8|t.charCodeAt(r+6)),this.v2.add(a.multiply(Ot)).rotl(31).multiply(kt),r+=8,a=Ut(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2),t.charCodeAt(r+5)<<8|t.charCodeAt(r+4),t.charCodeAt(r+7)<<8|t.charCodeAt(r+6)),this.v3.add(a.multiply(Ot)).rotl(31).multiply(kt),r+=8,a=Ut(t.charCodeAt(r+1)<<8|t.charCodeAt(r),t.charCodeAt(r+3)<<8|t.charCodeAt(r+2),t.charCodeAt(r+5)<<8|t.charCodeAt(r+4),t.charCodeAt(r+7)<<8|t.charCodeAt(r+6)),this.v4.add(a.multiply(Ot)).rotl(31).multiply(kt);else a=Ut(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v1.add(a.multiply(Ot)).rotl(31).multiply(kt),a=Ut(t[(r+=8)+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v2.add(a.multiply(Ot)).rotl(31).multiply(kt),a=Ut(t[(r+=8)+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v3.add(a.multiply(Ot)).rotl(31).multiply(kt),a=Ut(t[(r+=8)+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v4.add(a.multiply(Ot)).rotl(31).multiply(kt);r+=8}while(r<=h)}return r<n&&(i?this.memory+=t.slice(r):e?this.memory.set(t.subarray(r,n),this.memsize):t.copy(this.memory,this.memsize,r,n),this.memsize=n-r),this},Rt.prototype.digest=function(){var t,e,i=this.memory,r="string"==typeof i,s=0,n=this.memsize,o=new Ut;for(this.total_len>=32?((t=this.v1.clone().rotl(1)).add(this.v2.clone().rotl(7)),t.add(this.v3.clone().rotl(12)),t.add(this.v4.clone().rotl(18)),t.xor(this.v1.multiply(Ot).rotl(31).multiply(kt)),t.multiply(kt).add(Dt),t.xor(this.v2.multiply(Ot).rotl(31).multiply(kt)),t.multiply(kt).add(Dt),t.xor(this.v3.multiply(Ot).rotl(31).multiply(kt)),t.multiply(kt).add(Dt),t.xor(this.v4.multiply(Ot).rotl(31).multiply(kt)),t.multiply(kt).add(Dt)):t=this.seed.clone().add(Mt),t.add(o.fromNumber(this.total_len));s<=n-8;)r?o.fromBits(i.charCodeAt(s+1)<<8|i.charCodeAt(s),i.charCodeAt(s+3)<<8|i.charCodeAt(s+2),i.charCodeAt(s+5)<<8|i.charCodeAt(s+4),i.charCodeAt(s+7)<<8|i.charCodeAt(s+6)):o.fromBits(i[s+1]<<8|i[s],i[s+3]<<8|i[s+2],i[s+5]<<8|i[s+4],i[s+7]<<8|i[s+6]),o.multiply(Ot).rotl(31).multiply(kt),t.xor(o).rotl(27).multiply(kt).add(Dt),s+=8;for(s+4<=n&&(r?o.fromBits(i.charCodeAt(s+1)<<8|i.charCodeAt(s),i.charCodeAt(s+3)<<8|i.charCodeAt(s+2),0,0):o.fromBits(i[s+1]<<8|i[s],i[s+3]<<8|i[s+2],0,0),t.xor(o.multiply(kt)).rotl(23).multiply(Ot).add(Bt),s+=4);s<n;)o.fromBits(r?i.charCodeAt(s++):i[s++],0,0,0),t.xor(o.multiply(Mt)).rotl(11).multiply(kt);return e=t.clone().shiftRight(33),t.xor(e).multiply(Ot),e=t.clone().shiftRight(29),t.xor(e).multiply(Bt),e=t.clone().shiftRight(32),t.xor(e),this.init(this.seed),t};var Pt={h32:Nt,h64:Rt}.h64;try{self.edgemesh.v["edgemesh:hash:3.1.3"]=1}catch(We){}const zt=()=>Promise.resolve(),$t=t=>Pt(t,0).toString(16).padStart(16,"0"),jt=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let qt=(()=>yt.warn)(),Ft="worker";const Ht=t=>qt<=t,Vt=t=>{qt=t},Gt=()=>qt,Zt=t=>{Ft=t},Yt=yt.error,Jt=function(t,e,i){const r=0===t.indexOf("group")?Yt:yt[t];if(!Ht(r))return;if(!i||"groupCollapsed"===t&&jt)return void console[t](...e);const s=[`%c${Ft}`,`background: ${Kt[t]}; color: white; padding: 2px 0.5em; `+"border-radius: 0.5em;"];console[t](...s,...e)},Qt=()=>{Ht(Yt)&&console.groupEnd()},Xt={groupEnd:Qt,unprefixed:{groupEnd:Qt}},Kt={debug:"#7f8c8d",log:"#3498db",warn:"#f39c12",error:"#c0392b",groupCollapsed:"#ae4292"};Object.keys(Kt).forEach(t=>(t=>{Xt[t]=(...e)=>Jt(t,e,!0),Xt.unprefixed[t]=(...e)=>Jt(t,e)})(t));class te{constructor(t){this.title=t,this.logs=[],Object.keys(Kt).forEach(t=>{this[t]=(...e)=>this.logs.push({keyName:t,args:e})}),this.groupEnd=(...t)=>this.logs.push({keyName:"groupEnd",args:t})}end(){Xt.groupCollapsed(this.title);for(let{keyName:t,args:e}of this.logs)Xt.unprefixed[t](...e);Xt.groupEnd()}}Xt.LogGroup=te;var ee="3.1.3";const ie="color: #9E9E9E;",re="color: #9E9E9E;",se="color: #AE4292;",ne=se+"font-size: 20px;font-weight: lighter",oe=se+"font-size: 20px;font-weight: bold",he=(t,e,i)=>{console.log(`\n    %cEdge%cmesh%c\n\n    Version:     %c${ee}%c\n    Level:       %c${e}%c\n    Host:        %c${t}%c\n    Scope:       %c${i}%c\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,ne,oe,re,"color: #B4A454;",re,"color: #009688;",re,se,re,se,ie,se,ie,se)},ae=t=>{console.log(`\n    %cedge%cmesh%c v${ee}%c\n\n    There is a new version of Edgemesh available. Your browser will update\n    automatically once you complete your current session, or you can relaunch\n    your browser to update now.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,ne,oe,ie,re,ie,se,ie,se)},ce=t=>{console.log(`\n    %cedge%cmesh%c v${ee}%c\n\n    Your origin %c${t} %cis not validated.\n    Please visit the edgemesh portal at %chttps://portal.edgemesh.com%c\n    to validate your origin.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,ne,oe,ie,re,se,re,se,re,ie,se,ie,se)},le=t=>{console.log(`\n    %cedge%cmesh%c v${ee}%c\n\n    Your origin %c${t} %cis not registered.\n    Please visit the edgemesh portal at %chttps://portal.edgemesh.com%c\n    to register your origin.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,ne,oe,ie,re,se,re,se,re,ie,se,ie,se)},ue=()=>{console.log(`\n    %cedge%cmesh%c v${ee}%c\n\n    Your browser is running in %cdevmode%c.\n    To re-enable edgemesh, call %cedgemesh.devmode(false)%c.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,ne,oe,ie,re,se,re,se,re,ie,se,ie,se)},de={websocket:Boolean(window.WebSocket),serviceWorker:Boolean(window.ServiceWorker),localStorage:Boolean(window.localStorage),iddb:Boolean(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),crypto:Boolean(window.crypto)},ge=function(){let t=!0;return Object.keys(de).forEach(e=>{de[e]||(t=!1)}),t};class me{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}try{self.edgemesh.v["edgemesh:client:3.1.3"]=1}catch(We){}class fe{constructor(){this._eventListenerRegistry={}}addEventListener(t,e){this._getEventListenersByType(t).add(e)}removeEventListener(t,e){this._getEventListenersByType(t).remove(e)}dispatchEvent(t){t.target=this,this._getEventListenersByType(t.type).forEach(e=>e(t))}_getEventListenersByType(t){return this._eventListenerRegistry[t]=this._eventListenerRegistry[t]||new Set,this._eventListenerRegistry[t]}}var pe=(t,e)=>new URL(t,location).href===new URL(e,location).href;class _e{constructor(t,e){Object.assign(this,e,{type:t})}}const ye=200,we=6e4;class ve extends fe{constructor(t,e={}){super(),this._scriptURL=t,this._registerOptions=e,this._updateFoundCount=0,this._swDeferred=new me,this._activeDeferred=new me,this._controllingDeferred=new me,this._onMessage=this._onMessage.bind(this),this._onStateChange=this._onStateChange.bind(this),this._onUpdateFound=this._onUpdateFound.bind(this),this._onControllerChange=this._onControllerChange.bind(this)}async register({immediate:t=!1}={}){if(t||"complete"===document.readyState||await new Promise(t=>addEventListener("load",t)),this._isUpdate=Boolean(navigator.serviceWorker.controller),this._compatibleControllingSW=this._getControllingSWIfCompatible(),this._registration=await this._registerScript(),this._compatibleControllingSW&&(this._sw=this._compatibleControllingSW,this._swDeferred.resolve(this._compatibleControllingSW),this._activeDeferred.resolve(this._compatibleControllingSW),this._controllingDeferred.resolve(this._compatibleControllingSW),this._reportWindowReady(this._compatibleControllingSW),this._compatibleControllingSW.addEventListener("statechange",this._onStateChange,{once:!0})),this._registration.waiting&&pe(this._registration.waiting.scriptURL,this._scriptURL)&&Promise.resolve().then(()=>{this.dispatchEvent(new _e("waiting",{sw:this._registration.waiting,wasWaitingBeforeRegister:!0})),Xt.warn("A service worker was already waiting to activate before this script was registered.")}),Xt.log("Successfully registered service worker",this._scriptURL),navigator.serviceWorker.controller){this._compatibleControllingSW?Xt.debug("A service worker with the same script URL is already controlling this page."):Xt.debug("A service worker with a different script URL is currently controlling the page. The browser is now fetching the new script now."),(()=>{const t=new URL(this._registerOptions.scope||this._scriptURL,document.baseURI),e=new URL("./",t.href).pathname;return!location.pathname.startsWith(e)})()&&Xt.warn("The current page is not in scope for the registered service worker. Was this a mistake?")}return this._registration.addEventListener("updatefound",this._onUpdateFound),navigator.serviceWorker.addEventListener("controllerchange",this._onControllerChange,{once:!0}),"BroadcastChannel"in self&&(this._broadcastChannel=new BroadcastChannel("edgemesh"),this._broadcastChannel.addEventListener("message",this._onMessage)),navigator.serviceWorker.addEventListener("message",this._onMessage),this._registration}static async unregister(){navigator.serviceWorker.getRegistrations().then(t=>{for(let e of t)e.unregister({immediate:!0})})}get active(){return this._activeDeferred.promise}get controlling(){return this._controllingDeferred.promise}async getSW(){return this._sw||this._swDeferred.promise}async messageSW(t){const e=await this.getSW();let i=new MessageChannel;return i.port1.onmessage=t=>resolve(t.data),e.postMessage(t,[i.port2]),!0}sync(t){this._registration&&(this._registration.sync?this._registration.sync.register(t):this.messageSW({channel:"sync",data:t}))}_getControllingSWIfCompatible(){const t=navigator.serviceWorker.controller;if(t&&pe(t.scriptURL,this._scriptURL))return t}async _registerScript(){try{const t=await navigator.serviceWorker.register(this._scriptURL,this._registerOptions);return this._registrationTime=performance.now(),t}catch(t){throw t}}_reportWindowReady(t){this.dispatchEvent(new _e("ready",t))}_onUpdateFound(){const t=this._registration.installing;!!(this._updateFoundCount>0||!pe(t.scriptURL,this._scriptURL)||performance.now()>this._registrationTime+we)?(this._externalSW=t,this._registration.removeEventListener("updatefound",this._onUpdateFound)):(this._sw=t,this._swDeferred.resolve(t)),++this._updateFoundCount,t.addEventListener("statechange",this._onStateChange)}_onStateChange(t){const e=t.target,{state:i}=e,r=e===this._externalSW,s=r?"external":"",n={sw:e,originalEvent:t};switch(!r&&this._isUpdate&&(n.isUpdate=!0),this.dispatchEvent(new _e(s+i,n)),"installed"===i?this._waitingTimeout=setTimeout(()=>{"installed"===i&&this._registration.waiting===e&&this.dispatchEvent(new _e(s+"waiting",n))},ye):"activating"===i&&(clearTimeout(this._waitingTimeout),r||this._activeDeferred.resolve(e)),i){case"installed":r?Xt.warn("An external service worker has installed. You may want to suggest users reload this page"):Xt.log("Registered service worker installed");break;case"activated":r?Xt.warn("An external service worker has activated"):(Xt.log("Registered service worker activated"),e!==navigator.serviceWorker.controller&&Xt.warn("The registered service worker is active but not yet controlling the page. Reload or run `clients.claim()` in the service worker"));break;case"redundant":e===this._compatibleControllingSW?Xt.log("Previously controlling service worker now redundant!"):r||Xt.log("Registered service worker now redundant!")}}_onControllerChange(t){const e=this._sw;e===navigator.serviceWorker.controller&&(this.dispatchEvent(new _e("controlling",{sw:e,originalEvent:t})),this._controllingDeferred.resolve(e))}_onMessage(t){const{data:e}=t;this.dispatchEvent(new _e("message",{data:e,originalEvent:t}))}}class Ee extends fe{constructor(){super(),this._swDeferred=new me,navigator.serviceWorker&&navigator.serviceWorker.ready?navigator.serviceWorker.ready.then(t=>{this._registration=t,this._sw=navigator.serviceWorker.controller,this._swDeferred.resolve(this._sw),this._reportWindowReady(this._sw)}).catch(t=>{Xt.error(t)}):Xt.error(new Error("Service Worker is not supported by this browser."))}async getSW(){return this._sw||this._swDeferred.promise}async messageSW(t){const e=await this.getSW();let i=new MessageChannel;return i.port1.onmessage=t=>resolve(t.data),e.postMessage(t,[i.port2]),!0}sync(t){this._registration&&(this._registration.sync?this._registration.sync.register(t):this.messageSW({channel:"sync",data:t}))}_onMessage(t){const{data:e}=t;this.dispatchEvent(new _e("message",{data:e,originalEvent:t}))}_reportWindowReady(t){this.dispatchEvent(new _e("ready",t))}}class be{constructor(){this._isDataSaverEnabled=navigator.connection&&navigator.connection.saveData,this._allowQueryString="instantAllowQueryString"in document.body.dataset,this._allowExternalLinks="instantAllowExternalLinks"in document.body.dataset,this._prefetcher=document.createElement("link"),this._listenerOpts={capture:!0,passive:!0},this._prefetcher.relList&&this._prefetcher.relList.supports&&this._prefetcher.relList.supports("prefetch")&&!this._isDataSaverEnabled&&(this._touchendAndTouchcancelListener=this._touchendAndTouchcancelListener.bind(this),this._touchstartListener=this._touchstartListener.bind(this),this._mouseoverListener=this._mouseoverListener.bind(this),this._mouseoutListener=this._mouseoutListener.bind(this),this._prefetcher.rel="prefetch",document.head.appendChild(this._prefetcher),document.addEventListener("touchstart",this._touchstartListener,this._listenerOpts),document.addEventListener("mouseover",this._mouseoverListener,this._listenerOpts))}_touchstartListener(t){this._lastEventTime=performance.now();const e=t.target.closest("a");this._isPreloadable(e)&&(e.addEventListener("touchcancel",this._touchendAndTouchcancelListener,this._listenerOpts),e.addEventListener("touchend",this._touchendAndTouchcancelListener,this._listenerOpts),this._urlToPreload=e.href,this.preload(e.href))}_touchendAndTouchcancelListener(){this._urlToPreload=void 0,this.stopPreloading()}_mouseoverListener(t){if(performance.now()-this._lastEventTime<1100)return;const e=t.target.closest("a");this._isPreloadable(e)&&(e.addEventListener("mouseout",this._mouseoutListener,this._listenerOpts),this._urlToPreload=e.href,this._mouseoverTimer=setTimeout(()=>{this.preload(e.href),this._mouseoverTimer=void 0},65))}_mouseoutListener(t){t.relatedTarget&&t.target.closest("a")===t.relatedTarget.closest("a")||(this._mouseoverTimer?(clearTimeout(this._mouseoverTimer),this._mouseoverTimer=void 0):(this._urlToPreload=void 0,this.stopPreloading()))}_isPreloadable(t){if(!t||!t.href)return;if(this._urlToPreload===t.href)return;const e=new URL(t.href);return!(!(this._allowExternalLinks||e.origin===location.origin||"instant"in t.dataset)||!["http:","https:"].includes(e.protocol)||"http:"===e.protocol&&"https:"===location.protocol||!(this._allowQueryString||!e.search||"instant"in t.dataset)||e.hash&&e.pathname+e.search===location.pathname+location.search||"noInstant"in t.dataset)||void 0}preload(t){this._prefetcher.href=t}stopPreloading(){this._prefetcher.removeAttribute("href")}}const Ce={CACHE_EVENT:[["url","s"],["originId","j"],["assetId","j"],["sha0","j"],["sha1","j"],["sha2","j"],["sha3","j"]],ERROR_EVENT:[["originId","j"],["assetId","j"],["internal","b"],["status","i"],["statusText","s"],["url","s"],["serverIp","s"]],BALANCE_EVENT:[["originId","j"],["assetId","j"],["match","s"],["rule","s"],["originalUrl","s"],["redirectUrl","s"]],FIREWALL_EVENT:[["assetId","j"],["originId","j"],["rule","s"],["url","s"]],RESOURCE_EVENT:[["url","s"],["originId","j"],["assetId","j"],["cached","i"],["nextHopProtocol","s"],["transferSize","i"],["initiatorType","s"],["workerTime","i"],["tcpTime","i"],["dnsTime","i"],["reqTime","i"],["resTime","i"],["serverIp","s"]],NAVIGATION_EVENT:[["userAgent","j"],["viewportWidth","i"],["viewportHeight","i"],["documentWidth","i"],["documentHeight","i"],["firstClick","i"],["firstKeypress","i"],["firstScroll","i"],["inputDelay","i"],["firstIdle","i"],["tcpTime","i"],["dnsTime","i"],["reqTime","i"],["resTime","i"],["ttfb","i"],["startRender","i"],["contentLoaded","i"],["interactiveTime","i"],["firstPaint","i"],["pageLoad","i"],["url","s"],["navType","s"],["nextHopProtocol","s"],["referrer","s"],["assetCnt","i"],["accelAssetCnt","i"],["transferSize","i"],["timeOnPage","i"],["serverIp","s"]]},Ae=(t,e)=>{if("string"==typeof e){const i=Ce[t].find(t=>t[0]===e);return i?i[1]:-1}return Ce[t][e][1]},Te=75,Se="https://rte.edgeme.sh/events/metric",Le=2e3,Ie=50;class xe{constructor({nodeId:t,topic:e,ua:i,lite:r,cachedOverride:s,timeOnPageOverride:n}){Xt.log("Starting metrics reporter."),this._nodeId=t,this._topic=e,this._ua=i,this._lite=r,this._cachedOverride=s,this._timeOnPageOverride=n,this._cache=new Map,this._pending=new Map,this._elements=new Map,this._startTime=0,this._totalAssets=0,this._accelAssets=0,this.percentAccelerated=0,this._resourceBuffer=[],this.__observationTimer=null,this._setInteractionData(),this._setResourceData(),this._setCPUData(),this._isCached=this._isCached.bind(this)}sendPulse(){const t=new te("Gathering session performance.");try{t.debug("Creating metrics event.");const e=Object.assign({type:"NAVIGATION_EVENT"},this._getNodeData(),this._getInteractionData(),this._getCPUData(),this._getBackendData(),this._getFrontendData(),this._getNavData());if(t.debug("Metrics event created."),window.ga&&"function"==typeof window.ga&&"function"==typeof window.ga.getAll){const e=window.ga.getAll()[0];if(e){const i=e.get("name");window.ga(`${i}.send`,"event",{eventCategory:"Edgemesh",eventAction:"Percent Accelerated",eventLabel:String(this.percentAccelerated)},{nonInteraction:!0}),t.log(`Google analytics event sent: ${this.percentAccelerated}%`)}}t.log("Sending pulse."),t.end(),this._send("NAVIGATE",e)}catch(e){t.error(`An error occured while encoding performance metrics: ${e.message}`),t.end()}}_getNodeData(){return{nodeId:this._nodeId,topic:this._topic,userAgent:this._ua,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,documentWidth:document.documentElement.clientWidth,documentHeight:document.documentElement.clientHeight}}_setInteractionData(){const t={passive:!0,capture:!0};["click","keypress","scroll"].forEach(e=>{const i=()=>{const r=performance.now();this.firstInteraction||(this.firstInteraction=r),this[`${e}FirstInteraction`]=r,window.removeEventListener(e,i,t)};window.addEventListener(e,i,t)})}_getInteractionData(){return{firstClick:Math.round(this.clickFirstInteraction?this.clickFirstInteraction-this._startTime:-1),firstKeypress:Math.round(this.keypressFirstInteraction?this.keypressFirstInteraction-this._startTime:-1),firstScroll:Math.round(this.scrollFirstInteraction?this.scrollFirstInteraction-this._startTime:-1),inputDelay:Math.round(this.firstInteraction?this.firstInteraction-this._startTime:-1)}}_setCPUData(){window.requestIdleCallback?window.requestIdleCallback(()=>{this._firstIdle=Math.round(performance.now())}):this._firstIdle=-1}_getCPUData(){return{firstIdle:this._firstIdle||-1}}_getBackendData(){const t=performance.getEntriesByType("navigation")[0]||performance.timing;return{tcpTime:Math.round(t.connectEnd-t.connectStart),dnsTime:Math.round(t.domainLookupEnd-t.domainLookupStart),reqTime:Math.round(t.responseStart-t.requestStart),resTime:Math.round(t.responseEnd-t.responseStart),ttfb:Math.round(t.responseStart-(void 0!==t.startTime?t.startTime:t.navigationStart))}}_getFrontendData(){const t=performance.getEntriesByType("navigation")[0]||performance.timing,e=performance.getEntriesByName("first-contentful-paint")[0];return{startRender:Math.round(t.loadEventStart-(void 0!==t.startTime?t.startTime:t.navigationStart)),contentLoaded:Math.round(t.domContentLoadedEventEnd-(void 0!==t.startTime?t.startTime:t.navigationStart)),interactiveTime:Math.round(t.domInteractive-(void 0!==t.startTime?t.startTime:t.navigationStart)),firstPaint:e?Math.round(e.startTime-(void 0!==t.startTime?t.startTime:t.navigationStart)):-1,pageLoad:Math.round(t.domComplete-(void 0!==t.startTime?t.startTime:t.navigationStart))}}_getNavData(){const t=performance.getEntriesByType("navigation")[0]||performance.timing,e=performance.getEntriesByType("resource"),i=e.filter(this._isCached);return{url:t.name||document.location.href||ot.UNDEFINED,navType:t.type||ot.UNDEFINED,nextHopProtocol:t.nextHopProtocol||ot.UNDEFINED,referrer:document.referrer||ot.UNDEFINED,assetCnt:e.length,accelAssetCnt:i.length,transferSize:t.decodedBodySize||-1,timeOnPage:void 0!==this._timeOnPageOverride?this._timeOnPageOverride:Math.round(performance.now()-this._startTime)}}_setResourceData(){const t=performance.getEntriesByType("resource");if(t.length){const e=this._encodeResources(t);this._send("ADD_PULSE",e)}this.resourceObserver=new PerformanceObserver(this._observationHandler.bind(this)).observe({entryTypes:["resource"]})}_observationHandler(t){if((t=t.getEntries()).length>0){clearTimeout(this._observationTimer),this._resourceBuffer=this._resourceBuffer.concat(t);const e=()=>{const t=this._encodeResources(this._resourceBuffer);this._send("ADD_PULSE",t),this._resourceBuffer=[]};this._resourceBuffer.length>=Ie&&e(),this._observationTimer=setTimeout(e,Le)}}_isCached(t){if(void 0!==this._cachedOverride)return this._cachedOverride;const e=t.serverTiming;if(!(e&&e.length>0))return!t.transferSize&&t.duration<Te?1:0;{const t=e.find(t=>"edgemesh"===t.name);if(t)switch(t.description){case"origin":return 0;case"cached":return 1;case"precached":return 2}}}_getResourceData(t){if(!t.name)return;if(t.name.indexOf(Se)>-1)return;const{hostname:e,pathname:i,search:r}=new URL(t.name),s=`0x${$t(e)}`,n=`0x${$t(`${i}${r}`)}`,o=this._isCached(t);return this._totalAssets++,o&&this._accelAssets++,this.percentAccelerated=Math.round(this._accelAssets/this._totalAssets*100),{url:t.name,originId:s,assetId:n,cached:o,nextHopProtocol:t.nextHopProtocol||ot.UNDEFINED,transferSize:t.transferSize||-1,initiatorType:t.initiatorType||ot.UNDEFINED,workerTime:Math.round(t.fetchStart-t.workerStart),tcpTime:Math.round(t.connectEnd-t.connectStart),dnsTime:Math.round(t.domainLookupEnd-t.domainLookupStart),reqTime:Math.round(t.responseStart-t.requestStart),resTime:Math.round(t.responseEnd-t.responseStart)}}_encodeResources(t){try{return(t=t.map(t=>this._getResourceData(t)).filter(t=>void 0!==t)).length>0&&{type:"RESOURCE_EVENT",nodeId:this._nodeId,topic:this._topic,resources:t}}catch(e){throw Xt.error(`An error occurred encoding resource metrics: "${e.message}"`),e}}_send(t,e){if(0===Object.keys(e).length)return;const i=navigator.serviceWorker&&navigator.serviceWorker.controller,r=new te(`Sending ${e.type}.`);if(this.lite||!i){const t={};r.debug("data:",e),Object.keys(e).forEach(i=>{const r=Ae(e.type,i);t[i]="type"===i?ot.s(e[i]):"nodeId"===i||"topic"===i?ot.j(ot.hexToLowHigh(e[i])):"resources"===i?e[i].map(t=>{const i={};return Object.keys(t).forEach(r=>{const s=Ae(e.type,r);i[r]="j"===s?ot[s](ot.hexToLowHigh(t[r])):ot[s](t[r])}),i}):"j"===r?ot[r](ot.hexToLowHigh(e[i])):ot[r](e[i])}),r.debug("packet:",t);try{const i=ot.enc(t);r.log("encoded:",i.byteLength,"bytes"),fetch(Se,{method:"POST",headers:{accept:"application/octet-stream","content-type":"application/octet-stream"},body:i}).then(()=>{r.log(`${e.type} sent with fetch`),r.end()}).catch(t=>{r.error(`An error occured while sending METRICS_EVENT: "${t.message}"`),r.end()})}catch(s){Xt.error(s)}}else{navigator.serviceWorker.controller.postMessage({channel:pt(t),data:{channel:e.type,data:e}}),Xt.log(`${e.type} sent with service worker.`)}}}const Ne="em-log-level",Ue="em-id",ke="em-firewall",Oe="em-balance",Be="em-devmode",De="0x0000000000000000",Me="https://rte.edgeme.sh",Re=`${Me}/node/check`;return class{constructor(t={}){if(this.version=ee,this.swUrl=t.swUrl||"/sw.js",this.scope=t.scope||"/",this.host=t.host||Me,this.lite=t.lite||!1,this.externalMount=t.externalMount||!1,this.softDisable=t.softDisable||!1,this.isIOS=!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),this.lite&&this.externalMount)return void Xt.error(new Error('Both "externalMount" and "lite" can not be set at the same time.'));Zt("client");const e=parseInt(localStorage.getItem(Ne),10);if(e>=0&&e<=Object.keys(yt).length-1?this.setLogLevel(e):this.setLogLevel(yt.silent),localStorage.getItem(Be))return ue(),void this._disable();const i=localStorage.getItem(Ue);i?this._nodeId=i:(this._nodeId=_t(),localStorage.setItem(Ue,this._nodeId)),Xt.debug(`Node ID: ${this._nodeId}`),zt().then(()=>{if(this._topic=`0x${$t(document.location.hostname)}`,this._ua=`0x${$t(navigator.userAgent)}`,ge())this._register();else if(Xt.log("The current browser is not supported by Edgemesh."),this._startMetrics(0),this.isIOS)if("complete"===document.readyState)this._metrics.sendPulse();else{const t=this.isIOS?"pageshow":"load";window.addEventListener(t,()=>{this._metrics.sendPulse()})}}).catch(t=>{this._disable(t)}),this.isIOS||window.addEventListener("beforeunload",()=>{this._metrics?this._metrics.sendPulse():this._sw&&this._sw.messageSW({channel:pt("SEND_PULSE")})})}_register(){const t=new te(`Checking eligibility for node ${this._nodeId}.`),e=localStorage.getItem(ke)||De,i=localStorage.getItem(Oe)||De;let r;t.debug("encoding message");try{r=ht({topic:ut(ct(this._topic)),nodeId:ut(ct(this._nodeId)),userAgent:ut(ct(this._ua)),version:dt(this.version),firewallHash:ut(ct(e)),balanceHash:ut(ct(i))})}catch(s){return t.error(s.message),t.end()}t.debug(`message encoded to ${r.byteLength} bytes`),t.log("starting fetch"),fetch(Re,{method:"POST",headers:{"content-type":"application/octet-stream",accept:"application/octet-stream"},body:r}).then(async e=>{t.groupCollapsed("response details here"),t.log(e),t.groupEnd();try{const i=await e.arrayBuffer(),r=Buffer.from(new Uint8Array(i));t.debug(`response buffer length ${r.byteLength} bytes`);const s=at(r);t.groupCollapsed("decoded message here"),t.log(s),t.groupEnd();const n=s.error,o=s.message;if(n){switch(t.end(),n){case"TOPIC_NOT_VALIDATED":ce(document.location.hostname);break;case"TOPIC_NOT_REGISTERED":le(document.location.hostname);break;case"VERSION_INVALID":ae()}return this._disable(new Error(o))}if(s.firewall&&0!==s.firewall.length){t.log("new firewall rules");const e=`0x${$t(JSON.stringify(s.firewall))}`;localStorage.setItem(ke,e)}else localStorage.removeItem(ke);if(s.balance&&0!==s.balance.length){t.log("new balance rules");const e=`0x${$t(JSON.stringify(s.balance))}`;localStorage.setItem(Oe,e)}else localStorage.removeItem(Oe);const{level:h,name:a}=this.getLogLevel();h!==yt.silent&&he(this.host,a,this.scope),t.end(),s.nodeId=lt(s.nodeId),this._enable(s)}catch(s){t.end(),this._disable(s)}}).catch(e=>{t.error(e.message),t.end(),this._disable(e)})}_enable(t){Xt.log("Enabling edgemesh.");const e=(t.config>>>0).toString(2).padStart(32,0).split("").map(t=>parseInt(t,10));this.lite?(Xt.log("Edgemesh started in lite mode."),ve.unregister(),this._startMetrics()):this.externalMount?(Xt.log("External mount is set. Locating registered service worker."),this._sw=new Ee,this._sw.addEventListener("ready",()=>{Xt.log("Service worker ready."),this._startServices(t,e)})):(Xt.log("Registering service worker."),this._sw=new ve(this.swUrl,{scope:this.scope}),this._sw.addEventListener("waiting",()=>{console.log("A new service worker has installed, but it can't activate until all tabs running the current version have been closed.")}),this._sw.addEventListener("activated",()=>{Xt.log("Service worker activated."),this._startServices(t,e)}),this._sw.addEventListener("ready",()=>{Xt.log("Service worker ready."),this._startServices(t,e)}),this._sw.register())}_startServices(t,e){try{if(this._sw.messageSW({channel:pt("SET_CONFIG"),data:t}),this._startMetrics(),this._sw.messageSW({channel:pt("SET_DEBUG"),data:this.getLogLevel()}),e[17]&&(this._prefetch=new be),"complete"===document.readyState)this.isIOS&&this._metrics.sendPulse(),this._sw.sync("all");else{const t=this.isIOS?"pageshow":"load";window.addEventListener(t,()=>{this.isIOS&&this._metrics.sendPulse(),this._sw.sync("all")})}}catch(i){return Xt.error(i.message)}}_startMetrics(t){if(document.body)this._metrics=new xe({nodeId:this._nodeId,topic:this._topic,lite:this.lite,ua:this._ua,timeOnPageOverride:this.isIOS?-1:void 0,cachedOverride:t});else{const t=()=>{window.removeEventListener("load",t),this._startMetrics()};window.addEventListener("load",t)}}_disable(t){t&&Xt.error(t),this.softDisable?navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({channel:pt("SOFT_DISABLE")}):Xt.warn("Service Worker Controller not ready yet."):navigator.serviceWorker.controller?(navigator.serviceWorker.controller.postMessage({channel:pt("SEND_PULSE")}),ve.unregister()):Xt.warn("Service Worker Controller not ready yet."),Xt.log("Edgemesh service disabled.")}get LOG_LEVELS(){return yt}getLogLevel(){const t=Gt();return{level:t,name:Object.keys(yt)[t]}}setLogLevel(t){if("number"!=typeof t)return console.error('Log level must be a number. Use "edgemesh.LOG_LEVELS".');const e=Object.keys(yt)[t];if(!e)return console.error('Must be a valid log level. Use "edgemesh.LOG_LEVELS".');localStorage.setItem(Ne,t),Vt(t),Xt.log(`Setting log level to ${e}.`),this._sw&&this._sw.messageSW({channel:pt("SET_DEBUG"),data:{level:t,name:e}})}devmode(t){return t?(ue(),localStorage.setItem(Be,!0),this._disable(),setTimeout(()=>{window.location.reload()},200)):(localStorage.removeItem(Be),setTimeout(()=>{window.location.reload()},200)),`edgemesh devmode set to ${t}`}sync(t="all"){this._sw&&this._sw.sync(t)}}}();
